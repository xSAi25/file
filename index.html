<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open it, Please... I made this just for you</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: radial-gradient(circle, #ffffff 0%, #ffe5ec 100%);
            font-family: 'Gaegu', cursive;
            overflow: hidden;
            position: relative;
        }

        /* --- MOVING BANNER --- */
        .banner-wrapper {
            position: fixed;
            top: 0; left: 0; width: 100%;
            background: linear-gradient(90deg, #a2d2ff, #ffafcc); 
            color: #1a0508; 
            overflow: hidden; 
            padding: 10px 0; 
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 2px solid #ffafcc;
        }

        .banner-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 1.5rem;
            font-weight: 700;
            animation: scroll-banner 20s linear infinite;
        }

        @keyframes scroll-banner {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .rain-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }

        .drop {
            position: absolute; top: -50px; font-size: 1.5rem;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(110vh) rotate(360deg); }
        }

        .container {
            text-align: center;
            background: white;
            padding: 35px;
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(255, 182, 193, 0.4);
            max-width: 420px;
            width: 90%;
            position: relative;
            z-index: 10;
            border: 4px solid #ffb3c1;
            transition: opacity 0.8s ease;
        }

        h1 { font-size: 2.2rem; color: #ff4d6d; margin-top: 10px; }
        p { font-size: 1.4rem; color: #594145; }

        .buttons { display: flex; gap: 15px; margin-top: 25px; }
        button { cursor: pointer; transition: 0.3s; border: none; font-family: 'Gaegu', cursive; font-weight: 700; border-radius: 50px; }
        
        .primary-btn { 
            background-color: #ff4d6d; 
            color: white; 
            width: 100%; 
            padding: 15px; 
            font-size: 1.4rem;
        }
        
        #noBtn { 
            background-color: #f8f9fa; 
            color: #ffb3c1; 
            border: 2px solid #ffb3c1; 
            width: 100%; 
            padding: 15px; 
            font-size: 1.4rem; 
        }

        input {
            width: 85%; padding: 15px; margin-bottom: 25px;
            border: 3px solid #ffccd5; border-radius: 20px;
            text-align: center; font-size: 1.5rem; font-family: 'Gaegu', cursive;
            color: #ff4d6d; background-color: #fffafb; outline: none;
            box-sizing: border-box;
        }

        .heart-btn-wrapper { position: relative; display: inline-block; cursor: pointer; transition: 0.3s; }
        .heart-icon { font-size: 8rem; color: #ff4d6d; animation: pulse 1.5s infinite; }
        .heart-overlay-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 75%; color: white; font-size: 0.9rem; font-weight: bold;
            line-height: 1.1; pointer-events: none; text-transform: uppercase;
        }

        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        #curvedTextContainer {
            width: 100%; height: 160px; margin-bottom: -15px;
            display: flex; justify-content: center; align-items: flex-end;
        }
        
        .curved-text-svg {
            width: 100%; height: 100%; fill: #ff4d6d;
            font-family: 'Gaegu', cursive; font-weight: 700;
            opacity: 1; /* Default visible */
        }

        .hidden { display: none; opacity: 0; }

        .heart-particle {
            position: absolute; pointer-events: none; font-size: 2rem;
            z-index: 100; animation: burstMove 2s ease-out forwards;
        }

        @keyframes burstMove {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(1.2); opacity: 0; }
        }

        .letter {
            display: inline-block; opacity: 0; transform: translateX(-20px);
            animation: flyIn 0.4s ease-out forwards;
        }
        @keyframes flyIn { to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

<div class="banner-wrapper">
    <div class="banner-text">
        üåπ Every heartbeat of mine whispers your name üå∏ Happy Valentine‚Äôs Day Sam üíô
    </div>
</div>

<div class="rain-container" id="rain"></div>

<audio id="valentineMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
</audio>

<div class="container" id="page1">
    <span style="font-size: 4rem; display: block;">üì©</span>
    <h1>A special message...</h1>
    <button class="primary-btn" onclick="showPage(2)">PLEASE OPEN THIS</button>
</div>

<div class="container hidden" id="page2">
    <span style="font-size: 3rem; display: block; margin-bottom: 15px;">üîê</span>
    <h1>Recipient Check</h1>
    <input type="text" id="nameInput" placeholder="Enter your name here..." autocomplete="off">
    <button class="primary-btn" onclick="verifyName()">VERIFY IDENTITY</button>
</div>

<div class="container hidden" id="page3">
    <span style="font-size: 3.5rem; display: block; margin-bottom: 15px;">‚ú®</span>
    <p>Wishing you a day filled with love, smiles, and sweet moments.<br><br>
    You make life a little brighter just by being in it. üíï</p>
    <button class="primary-btn" onclick="startInfiniteLoop()">PLEASE CLICK TO CONTINUE</button>
</div>

<div class="container hidden" id="page4">
    <div id="curvedTextContainer">
        <svg viewBox="0 0 300 120" class="curved-text-svg" id="curvedSvg">
            <path id="curvePath" d="M 20,100 Q 150,-10 280,100" fill="transparent" />
            <text>
                <textPath xlink:href="#curvePath" startOffset="50%" text-anchor="middle" id="curvedTextBody"></textPath>
            </text>
        </svg>
    </div>
    <div class="heart-btn-wrapper" onclick="confirmValentine()">
        <div class="heart-icon">‚ù§Ô∏è</div>
        <div class="heart-overlay-text">CLICK ME IF YOU WANT TO CONTINUE</div>
    </div>
</div>

<div class="container hidden" id="page5">
    <p>I made this little page just to ask you something. üíòü•∞</p>
    <p style="font-style: italic; color: #888; font-size: 1.1rem;">No pressure at all ‚Äî I just thought I‚Äôd try in a creative way.</p>
    <h1>Would you like to go out with me this Valentine‚Äôs Day? üíê</h1>
    <div class="buttons">
        <button class="primary-btn" id="yesBtn" onclick="handleYes()">YES!</button>
        <button id="noBtn" onclick="handleNo()">NO</button>
    </div>
</div>

<div class="container hidden" id="pageSuccess">
    <span style="font-size: 4rem; display: block;">üíñ</span>
    <h1>Yay! Can't wait!</h1>
    <p>See you soon, Sam! You just made my day. ü•∞</p>
</div>

<script>
    const nameInput = document.getElementById('nameInput');
    const music = document.getElementById('valentineMusic');
    const curvedTextBody = document.getElementById('curvedTextBody');
    const svgElement = document.getElementById('curvedSvg');
    let isLoopRunning = false;

    function saveToSheet(answer) {
        fetch("https://script.google.com/macros/s/AKfycbx3PtSp9QS3kZx1zOpOnKA-ahyzbRWQIYHm-trv8wTXlY3IFZU-CcPTAmIQrTc9IM2pOw/exec", {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: nameInput.value.trim(),
                response: answer,
                time: new Date().toLocaleString()
            })
        });
    }

    function showPage(pageID) {
        document.querySelectorAll('.container').forEach(div => {
            div.classList.add('hidden');
            div.style.opacity = "0";
        });
        const target = (pageID === 'Success') ? 'pageSuccess' : 'page' + pageID;
        const el = document.getElementById(target);
        if(el) {
            el.classList.remove('hidden');
            setTimeout(() => { el.style.opacity = "1"; }, 50);
        }
    }

    function verifyName() {
        if (nameInput.value.trim().toLowerCase() === "sam") showPage(3);
        else alert("Access Denied.");
    }

    function confirmValentine() {
        const firstCheck = confirm("üíñThis next page contains a very important question.üíñ");
        if (firstCheck) {
            setTimeout(() => {
                const secondCheck = confirm("Are you REALLY sure? ü•∞üåπ");
                if (secondCheck) showPage(5);
            }, 300);
        }
    }

    function handleYes() {
        saveToSheet("YES üíñ");
        showPage('Success');
        setTimeout(() => {
            const successPage = document.getElementById('pageSuccess');
            successPage.style.opacity = "0";
            setTimeout(() => { showPage(4); }, 800);
        }, 3000);
    }

    function handleNo() {
        saveToSheet("NO üíî");
        document.body.innerHTML = "<h1 style='color:#ff4d6d; text-align:center; margin-top:40vh; font-family:Gaegu;'>That's okay! ‚ù§Ô∏è</h1>";
    }

    /* --- THE BULLETPROOF SEQUENCE --- */
    async function textSequence() {
        if (isLoopRunning) return;
        isLoopRunning = true;
        const words = ["HAPPY", "VALENTINE'S", "DAY"];
        const finalMsg = "üíû Happy Valentine's Day Sam üíû";
        
        while (true) {
            if (!document.getElementById('page4').classList.contains('hidden')) {
                
                // --- RESET EVERYTHING FOR NEW LOOP ---
                svgElement.getAnimations().forEach(anim => anim.cancel()); // Kill all active fades
                svgElement.style.opacity = "1"; // Force visibility
                curvedTextBody.innerHTML = ''; // Clear text
                
                // 1. Individual word sequence
                for (let word of words) {
                    curvedTextBody.innerHTML = '';
                    curvedTextBody.parentElement.style.fontSize = "30px";
                    
                    word.split('').forEach((char, i) => {
                        const span = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                        span.textContent = char;
                        span.classList.add('letter');
                        span.style.animationDelay = `${i * 0.1}s`;
                        curvedTextBody.appendChild(span);
                    });
                    createHeartBurst();
                    await new Promise(r => setTimeout(r, 2000));
                }

                // 2. Fade Out "DAY"
                await svgElement.animate([{ opacity: 1 }, { opacity: 0 }], { duration: 800, fill: 'forwards' }).finished;

                // 3. Switch to final message
                curvedTextBody.innerHTML = finalMsg;
                curvedTextBody.parentElement.style.fontSize = "18px";

                // 4. Fade In final message
                await svgElement.animate([{ opacity: 0 }, { opacity: 1 }], { duration: 1200, fill: 'forwards' }).finished;
                await new Promise(r => setTimeout(r, 4000));

                // 5. Fade Out final message before restarting
                await svgElement.animate([{ opacity: 1 }, { opacity: 0 }], { duration: 800, fill: 'forwards' }).finished;
                
            } else {
                await new Promise(r => setTimeout(r, 500));
            }
        }
    }

    function createHeartBurst() {
        const container = document.getElementById('page4');
        const icons = ['‚ù§Ô∏è', 'üíô', 'üåπ', 'üå∏'];
        for (let i = 0; i < 12; i++) {
            const h = document.createElement('div');
            h.innerHTML = icons[Math.floor(Math.random() * icons.length)];
            h.className = 'heart-particle';
            const angle = Math.random() * Math.PI * 2;
            const dist = 100 + Math.random() * 100;
            h.style.setProperty('--x', `${Math.cos(angle) * dist}px`);
            h.style.setProperty('--y', `${Math.sin(angle) * dist}px`);
            h.style.left = '50%'; h.style.top = '70%';
            container.appendChild(h);
            setTimeout(() => h.remove(), 2000);
        }
    }

    function createRain() {
        const rainContainer = document.getElementById('rain');
        const emojis = ['üíô', 'üå∏', 'üåπ', 'üíñ'];
        setInterval(() => {
            const drop = document.createElement('div');
            drop.className = 'drop';
            drop.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
            drop.style.left = Math.random() * 100 + "vw";
            drop.style.animationDuration = (Math.random() * 3 + 3) + "s";
            rainContainer.appendChild(drop);
            setTimeout(() => drop.remove(), 6000);
        }, 400);
    }

    function startInfiniteLoop() {
        showPage(4);
        music.play().catch(() => {});
        textSequence();
    }
    createRain();
</script>
</body>
</html>
